{% extends 'base.html' %}

{% block title %}
Home page
{% endblock title %}

{% block content %}
<link rel="stylesheet" href="{{url_for('index.static',filename='css/index.css') }}">
<link rel="stylesheet" type="text/css" href="{{url_for('index.static',filename='css/emoji/jquery.emojipicker.css') }}">
<div class="main_wrapper" style="display:flex; padding:20px auto;">

<div class='chat_sidebar' style="width:29%; margin-top:100px;">


  <script type="text/javascript" src="//code.jquery.com/jquery-1.4.2.min.js"></script>
  
  <script type="text/javascript" src="{{url_for('index.static',filename='js/emoji/jquery.emojipicker.js') }}"></script>

  <!-- Emoji Data -->
  <link rel="stylesheet" type="text/css" href="{{url_for('index.static',filename='css/emoji/jquery.emojipicker.a.css') }}">

        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>


        <script type="text/javascript" charset="utf-8">
          //Emojies
         
        // $('#em_trigger').emojiPicker('destroy');
  
            var socket;
            $(document).ready(function(){
              
                socket = io.connect('http://' + document.domain + ':' + location.port+'/');
                socket.on('connect', function() {
                    socket.emit('joined', {});
                });
                socket.on('user_leave', function(data) {
                    $('#chat').val($('#chat').val() + '<' + data.msg +'>\n');
                    $('#chat').scrollTop($('#chat')[0].scrollHeight); 
                    let cnt = data.clients_count
                    $('#onlineStatusChecker').html(`Online ${cnt} user`) ;
                }); 
                socket.on('status', function(data) {
                    $('#chat').val($('#chat').val() + '<' + data.msg +'>\n');
                    $('#chat').scrollTop($('#chat')[0].scrollHeight); 
                    let cnt = data.clients_count
                    $('#onlineStatusChecker').html(`Online ${cnt} user`) ;
                });   
                  
                socket.on('message', function(data) { 
                    $('#chat').val($('#chat').val() + data.msg + '\n'); 
                    $('#chat').scrollTop($('#chat')[0].scrollHeight);
                });
                $('#text').keypress(function(e) {
                    var code = e.keyCode || e.which;
                    if (code == 13) {
                        text = $('#text').val();
                        $('#text').val('');
                        socket.emit('text', {msg: text});
                    }
                });
            });
        </script>

        <h1 style="font-size:30px;text-align:center;margin-bottom:10px;">Online chat</h1>
        <p id="onlineStatusChecker"></p>
        <textarea id="chat" cols="80" rows="40" style="width:100%;"></textarea><br><br>
        {% if current_user.is_authenticated %}
          <input id="text" size="80" placeholder="Enter your message here" style="width:100%; height:55px;"><br><br>
        {% else %}  
          <p>Please <a href="{{url_for('users.register')}}">register</a>,or  <a href="{{url_for('users.login')}}">login</a> to leave comment !!</p>
        {% endif %}

</div>


<div class="cont s--inactive" style="width:100%;">
  <!-- cont inner start -->
  <h1 style="font-size:30px;text-align:center;margin:20px auto;">Top Recipes</h1>

  <div class="cont__inner">


  {% for rec in range(tops|length)  %}
   <!-- el start -->
    <div class="el">
      <div class="el__overflow">
        <div class="el__inner">
          <div class="el__bg" style="background:url('{{tops[rec].img_link}}');background-size: cover"></div>
          <div class="el__preview-cont">
            <h2 class="el__heading">{{tops[rec].name}}</h2>
          </div>
          <div class="el__content">
            <div class="el__text">{{tops[rec].name}}</div>
            <div class="el__text_descr">{{tops[rec].instructions}}</div>
            <div class="el__text_btn">
            <a class="btn btn-info" href={{url_for('meals.meal_info' , m_id=tops[rec].id)}}> More info </a>
            </div>
            <div class="el__close-btn"></div>
          </div>
        </div>
      </div>
      <div class="el__index">
        <div class="el__index-back">{{rec+1}}</div>
        <div class="el__index-front">
          <div class="el__index-overlay" data-index="{{rec+1}}">{{rec+1}}</div>
        </div>
      </div>
    </div>
    <!-- el end -->
  
  {% endfor %}

  </div>
  <!-- cont inner end -->
</div>

</div>


{% endblock content %}
